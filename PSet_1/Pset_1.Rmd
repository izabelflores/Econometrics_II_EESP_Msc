---
title: "Problem Set 1"
author: "Izabel Flores"
date: "`r Sys.Date()`"
output:
  pdf_document: default
    
---

```{r setup, warning = FALSE, message = FALSE, error = FALSE, echo = FALSE}

knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      error = FALSE,
                      echo = FALSE)
```

```{r}
#### PSET 1 ####

library(readr) # importar
library(dplyr) # limpeza
library(quantmod) # time series
library(stargazer) # tabela
library(doParallel)
library(gganimate)
library(transformr)
```


## Question 1 (Forecasting GDP Growth - 150 points)

```{r}
# importando

data <- read_csv("Problem Set 1/data/data_gdp_brazil.csv")

# limpando

colnames(data) <- c("year", "gdp_brazil") # renomear colunas

data_xts <- xts( # objeto xts
  x = data$gdp_brazil,
  order.by = as.Date(as.character(data$year), format = "%Y")
)

# Parameters

P <- 2 # parametro maximo do AR
Q <- 2 # parametro maximo do MA

alpha <- 0.05 # Significance level

```

```{r}
# estimando

arma <- vector(mode = "list", length = 0)

# Loop through all combinations of p and q

for (p in 0:P) {
  for (q in 0:Q) {
    # Define the name of the element based on p and q
    name <- if (p == 0) {
      paste0("MA(", q, ")")
    } else if (q == 0) {
      paste0("AR(", p, ")")
    } else {
      paste0("ARMA(", p, ",", q, ")")
    }
    # Estimate an ARMA(p,q) model and store it in the corresponding element
    arma[[name]] <- arima(
      x = data_xts,
      order = c(p, 0, q),
      include.mean = TRUE
    )
  }
}

arma[["MA(0)"]] <- NULL # retirar MA(0)

```

```{r}

#### report ####

# cria a funcao que reporta as regressoes

tabela_regressoes <- function(lista_regressoes) {
  
  # cria a lista com os nomes das regressoes
  nomes <- sapply(lista_regressoes, function(x) deparse(substitute(x)))
  
  # cria a tabela com as regressoes
  stargazer(lista_regressoes, 
            title = "(a) estimated coefficients, standard errors and p-values",
            type = "latex",
            column.labels = names(lista_regressoes),
            header = FALSE,
            keep.stat = c("n"),
            font.size= "small",
            model.numbers = FALSE)
}


```

```{r, results='asis'} 
# chama a funcao

table <- tabela_regressoes(arma)

cat("\n")
```

```{r}
#### BIC e AIC ####

# criar matriz vazia para armazenar resultados
result_matrix <- matrix(nrow = 2, ncol = length(arma), dimnames = list(c("AIC", "BIC"), names(arma)))

# calcular AIC e BIC para cada modelo
for (i in seq_along(arma)) {
  result_matrix["AIC", names(arma)[i]] <- AIC(arma[[i]])
  result_matrix["BIC", names(arma)[i]] <- BIC(arma[[i]])
}

```

```{r, results='asis'} 

# imprimir matriz de resultados

table <- stargazer(result_matrix, 
                   type = "latex",  
                   header = FALSE,
                   title = "(b) Estimated BIC and AIC")

cat("\n")
```

## Question 2 (ARMA(p,q) MLE Estimator's Asymptotic Behavior - 200 points

```{r}
#### Parameters ####

# fixos

M <- 10 # Number of MC repetitions

capT_vec <- c(30:100, seq(110, 200, 10), seq(250, 500, 50)) # Length of the time series

delta <- c(0.25, 0.2, 0.15, 0.1) # Allowed distance for convergence in probability

```

```{r}

# ler as funcoes criadas para rodar os experimentos de monte carlo

source('funcos_MC.R')
```


### 2.1 MA(1), c = 0, theta = 0.5

#### N(0,1)

```{r}
MA1_N <- monte_carlo_ARMA(p = 0, 
                 q = 1, 
                 g = 1, 
                 theta = 0.5, 
                 c = FALSE)

convergence_probability(MA1_N)
convergence_distribution(MA1_N)
```

#### exp(1)

```{r}
MA1_exp <- monte_carlo_ARMA(p = 0, 
                 q = 1, 
                 g = 0, 
                 theta = 0.5, 
                 c = FALSE)

convergence_probability(MA1_exp)

```


### 2.2 



